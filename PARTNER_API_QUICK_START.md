# 🚀 Partner API - מדריך מהיר לשימוש

## 📍 איפה למצוא את הממשקים?

### אם אתה Super Admin:

1. **התחבר למערכת**
2. **הסתכל בסיידבר (צד ימין)**
3. **גלול למטה עד שתראה סעיף:**
   ```
   🔑 PARTNER API
   ```

תראה שני קישורים:
- 🔑 **ניהול API Keys** - יצירה וניהול של מפתחות לשותפים
- 🏢 **גילוי חברות** - מציאת Company IDs

---

## 🔑 שלב 1: יצירת API Key לשותף

### 📍 נתיב: `/dashboard/admin/partner-api`

**מה תראה בדף:**
1. **טופס יצירת מפתח חדש** (בראש הדף)
2. **טבלה עם מפתחות קיימים** (מתחת)

**איך ליצור מפתח:**

```
┌─────────────────────────────────────────┐
│  🔐 יצירת מפתח חדש                      │
├─────────────────────────────────────────┤
│                                          │
│  שם השותף: [CompanyX Call Center]      │
│  חברה (אופציונלי): [בחר מהרשימה...]    │
│  סביבה: [Sandbox ▼]                     │
│  תוקף (ימים): [365]                     │
│                                          │
│  [🔑 צור מפתח חדש]                      │
└─────────────────────────────────────────┘
```

**לחץ על הכפתור ותקבל:**

```
┌─────────────────────────────────────────┐
│  ✅ מפתח חדש נוצר בהצלחה!               │
│                                          │
│  ⚠️  שמור את המפתחות! מוצגים פעם אחת!  │
│                                          │
│  API Key:                                │
│  pk_sandbox_abc123def456...              │
│  [📋 העתק]                               │
│                                          │
│  API Secret:                             │
│  sk_xyz789abc123...                      │
│  [📋 העתק]                               │
└─────────────────────────────────────────┘
```

**⚠️ חשוב:** העתק את שני המפתחות! הם מוצגים פעם אחת בלבד!

---

## 🏢 שלב 2: גילוי Company IDs

### 📍 נתיב: `/dashboard/admin/companies-list`

**מה תראה בדף:**

```
┌─────────────────────────────────────────────────────┐
│  🏢 רשימת חברות                                     │
├─────────────────────────────────────────────────────┤
│                                                      │
│  [🔍 חפש לפי שם, תעשייה או ID...]  [🔄 רענן]      │
│                                                      │
│  ┌──────────────────────────────────────────────┐  │
│  │  📊 סה"כ חברות: 25                           │  │
│  │  👥 סה"כ אג'נטים: 150                       │  │
│  │  📞 סה"כ שיחות: 5,420                       │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
│  ┌────────────────────────────────────────────────┐│
│  │ שם החברה  │ Company ID      │ תעשייה │ פעולות ││
│  ├────────────────────────────────────────────────┤│
│  │ Test Co   │ 550e8400... 📋  │ retail │ [העתק] ││
│  │ Acme Ltd  │ 660e8400... 📋  │ tech   │ [העתק] ││
│  └────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────┘
```

**איך למצוא Company ID:**
1. חפש את החברה בשורת החיפוש
2. לחץ על כפתור 📋 ליד ה-ID
3. ה-ID הועתק!

---

## 📤 שלב 3: שליחת המידע לשותף

שלח לשותף שלך:

```markdown
# 🔐 פרטי חיבור ל-Partner API

## API Credentials
**API Key:** pk_sandbox_abc123def456...
**API Secret:** sk_xyz789abc123...

## Base URL
**Sandbox:** https://yourdomain.com/api/partner/v1

## Company IDs Available
- Test Company: 550e8400-e29b-41d4-a716-446655440000
- Acme Ltd: 660e8400-e29b-41d4-a716-446655440001

## Documentation
📖 כל התיעוד נמצא ב: PARTNER_API_README.md
📮 Postman Collection: docs/Partner-API.postman_collection.json
💻 Code Examples: docs/examples/
```

---

## 🧪 שלב 4: בדיקה מהירה

השותף יכול לבדוק שהכל עובד:

```bash
# Health Check
curl -X GET "https://yourdomain.com/api/partner/v1/health" \
  -H "Authorization: Bearer pk_sandbox_..." \
  -H "X-API-Secret: sk_..."
```

**תשובה צפויה:**
```json
{
  "status": "ok",
  "environment": "production",
  "partner_name": "CompanyX Call Center",
  "timestamp": "2024-12-02T20:00:00Z"
}
```

---

## 📚 תיעוד מלא

### קבצים חשובים שיש לשלוח לשותף:

1. **`PARTNER_API_README.md`** - מדריך מלא
2. **`docs/Partner-API.postman_collection.json`** - אוסף בקשות מוכן
3. **`docs/examples/`** - דוגמאות קוד ב-4 שפות:
   - `nodejs-example.js`
   - `python-example.py`
   - `php-example.php`
   - `curl-examples.sh`

---

## 🔄 זרימת עבודה טיפוסית של השותף

```
1. Health Check ✅
   ↓
2. List Companies 📋
   ↓
3. Create Agent 👤
   ↓
4. Analyze Call 🎤
   ↓
5. Poll for Results 🔄
   OR
   Receive Webhook 📨
```

---

## 🎯 Endpoints העיקריים

| Endpoint | Method | תיאור |
|----------|--------|-------|
| `/health` | GET | בדיקת חיבור |
| `/companies` | GET | **🆕 גילוי חברות** |
| `/companies/create` | POST | יצירת חברה |
| `/companies/{id}` | GET | פרטי חברה |
| `/companies/{id}/agents/create` | POST | יצירת אג'נט |
| `/companies/{id}/agents` | GET | רשימת אג'נטים |
| `/calls/analyze` | POST | ניתוח שיחה |
| `/jobs/{id}/status` | GET | סטטוס משימה |

---

## ⚠️ נקודות חשובות

### 1. 🔒 אבטחה
- ה-API Key וה-Secret חייבים להישמר במאובטח
- אף פעם לא לשתף אותם בגיטהאב או במייל לא מוצפן
- השתמש במשתני סביבה

### 2. 🔑 הרשאות
- אם קשרת API Key לחברה ספציפית - הוא יכול לגשת רק אליה
- אם לא - יש לו גישה לכל החברות (צריך Company ID בכל בקשה)

### 3. 🔄 Rate Limiting
- ברירת מחדל: 1000 requests לדקה
- ניתן לשנות בממשק הניהול

### 4. 📨 Webhooks
- השותף צריך endpoint שיקבל POST requests
- המערכת שולחת HMAC-SHA256 signature לאימות
- עד 3 ניסיונות חוזרים

---

## 🆘 פתרון בעיות

### "לא רואה את הסעיף Partner API"
✅ **פתרון:** וודא שאתה מחובר כ-`super_admin` (לא `admin` רגיל)

### "השותף לא מקבל חברות"
✅ **פתרון:** בדוק אם ה-API Key קשור לחברה ספציפית

### "Webhook לא עובד"
✅ **פתרון:** 
1. בדוק שה-endpoint של השותף מגיב עם 200
2. בדוק לוגים בטבלת `webhook_logs`

---

## 🎉 מוכן!

המערכת שלך עכשיו כוללת:
- ✅ ממשק ניהול מפתחות מלא
- ✅ גילוי חברות קל ונוח
- ✅ API מלא ומאובטח
- ✅ תיעוד מקיף
- ✅ דוגמאות קוד

**השותף שלך יכול להתחיל לעבוד! 🚀**

